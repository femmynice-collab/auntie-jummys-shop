{% extends 'base.html' %}
{% block content %}
  <div class="p-4 rounded-3 mb-4" style="background: var(--aj-light);">
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
      <div>
        <h1 class="fw-bold mb-1">Sweet treats delivered fast</h1>
        <p class="mb-0 text-muted">Candy, chips, chocolate, cookies, drinks, and more. Local, family-owned üíñ</p>
      </div>
      {% if DOORDASH_URL %}
        <a class="btn btn-primary btn-lg" href="{{ DOORDASH_URL }}" target="_blank" rel="noopener">Order on DoorDash</a>
      {% endif %}
    </div>
  </div>

  {% if promos %}
  <div class="alert alert-warning rounded-3 mb-4">
    <strong>üéÅ Limited-time deals:</strong>
    {% for pr in promos %}
      <span class="badge text-bg-light border me-2">Use <code>{{ pr.code }}</code>{% if pr.discount_type == 'percent' %} ({{ pr.value }}% off){% else %} (${{ pr.value }} off){% endif %}</span>
    {% empty %}No active promos right now.{% endfor %}
  </div>
{% endif %}

{% if featured %}
  <h3 class="fw-bold">Featured favorites</h3>
  <div class="row g-3 mb-4">
    {% for p in featured %}
      <div class="col-6 col-md-3">
        <div class="card h-100 position-relative">
          {% if promos %}<span class="position-absolute top-0 start-0 translate-middle-y ms-2 mt-2 badge rounded-pill text-bg-warning promo-badge">Deal</span>{% endif %}
          {% if p.image %}<img src="{{ p.image.url }}" class="card-img-top" alt="{{ p.name }}">{% endif %}
          <div class="card-body d-flex flex-column">
            <h6 class="card-title">{{ p.name }}</h6>
            <div class="mt-auto d-flex justify-content-between align-items-center">
              <span class="fw-bold">${{ p.price }}</span>
              <a href="{{ p.get_absolute_url }}" class="btn btn-sm btn-primary">View</a>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <h3 class="fw-bold">Bestsellers</h3>
  <div id="bestsellersCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
    <div class="carousel-inner">
      {% for p in bestsellers %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        <div class="row justify-content-center">
          <div class="col-10 col-md-6">
            <div class="card text-center">
              {% if p.image %}<img src="{{ p.image.url }}" class="card-img-top" alt="{{ p.name }}">{% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ p.name }}</h5>
                <p class="card-text fw-bold mb-3">${{ p.price }}</p>
                <a href="{{ p.get_absolute_url }}" class="btn btn-primary">View</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#bestsellersCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#bestsellersCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
  <div class="row g-3 mb-4">
    {% for p in bestsellers %}
      <div class="col-6 col-md-3">
        <div class="card h-100 position-relative">
          {% if promos %}<span class="position-absolute top-0 start-0 translate-middle-y ms-2 mt-2 badge rounded-pill text-bg-warning promo-badge">Deal</span>{% endif %}
          {% if p.image %}<img src="{{ p.image.url }}" class="card-img-top" alt="{{ p.name }}">{% endif %}
          <div class="card-body d-flex flex-column">
            <h6 class="card-title">{{ p.name }}</h6>
            <div class="mt-auto d-flex justify-content-between align-items-center">
              <span class="fw-bold">${{ p.price }}</span>
              <a href="{{ p.get_absolute_url }}" class="btn btn-sm btn-primary">View</a>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No sales yet ‚Äî your first orders will show here.</p>
    {% endfor %}
  </div>

  {% if near_zip %}<h3 class="fw-bold">Popular near {{ near_zip }}</h3>
  <div class="row g-3 mb-4">
    {% for p in bestsellers %}
      <div class="col-6 col-md-3">
        <div class="card h-100 position-relative">
          {% if promos %}<span class="position-absolute top-0 start-0 translate-middle-y ms-2 mt-2 badge rounded-pill text-bg-warning promo-badge">Deal</span>{% endif %}
          {% if p.image %}<img src="{{ p.image.url }}" class="card-img-top" alt="{{ p.name }}">{% endif %}
          <div class="card-body d-flex flex-column">
            <h6 class="card-title">{{ p.name }}</h6>
            <div class="mt-auto d-flex justify-content-between align-items-center">
              <span class="fw-bold">${{ p.price }}</span>
              <a href="{{ p.get_absolute_url }}" class="btn btn-sm btn-primary">View</a>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>{% endif %}

  <h3 class="fw-bold">All products</h3>
  <div class="row g-3">
    {% for p in products %}
      <div class="col-6 col-md-3">
        <div class="card h-100 position-relative">
          {% if promos %}<span class="position-absolute top-0 start-0 translate-middle-y ms-2 mt-2 badge rounded-pill text-bg-warning promo-badge">Deal</span>{% endif %}
          {% if p.image %}<img src="{{ p.image.url }}" class="card-img-top" alt="{{ p.name }}">{% endif %}
          <div class="card-body d-flex flex-column">
            <h6 class="card-title">{{ p.name }}</h6>
            <div class="mt-auto d-flex justify-content-between align-items-center">
              <span class="fw-bold">${{ p.price }}</span>
              <a href="{{ p.get_absolute_url }}" class="btn btn-sm btn-primary">View</a>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No products yet. Add some in admin.</p>
    {% endfor %}
  </div>
{% endblock %}
